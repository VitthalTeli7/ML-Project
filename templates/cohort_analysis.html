{% extends "base.html" %}

{% block title %}Cohort Analysis | ChurnAI - Enterprise Retention Analytics{% endblock %}

{% block extra_css %}
<style>
    /* =====================================================
       COHORT ANALYSIS - PREMIUM ENTERPRISE EDITION
       Retention Matrix | Customer Cohorts | Trend Analysis
       Glassmorphism | 3D Effects | Micro-interactions
       Dark Mode Ready | Fully Responsive
       ===================================================== */

    :root {
        --cohort-primary: #6366f1;
        --cohort-secondary: #8b5cf6;
        --cohort-accent: #ec4899;
        --cohort-success: #10b981;
        --cohort-warning: #f59e0b;
        --cohort-danger: #ef4444;
        --cohort-info: #3b82f6;
        --cohort-dark: #0f172a;
        --cohort-light: #f8fafc;
    }

    .cohort-wrapper {
        padding: 30px 0 60px;
        animation: fadeIn 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideInRight {
        from { opacity: 0; transform: translateX(30px); }
        to { opacity: 1; transform: translateX(0); }
    }

    /* ===== PREMIUM HEADER ===== */
    .cohort-header {
        background: rgba(255, 255, 255, 0.92);
        backdrop-filter: blur(24px) saturate(180%);
        -webkit-backdrop-filter: blur(24px) saturate(180%);
        border-radius: 48px;
        padding: 40px 50px;
        margin-bottom: 40px;
        border: 1px solid rgba(255, 255, 255, 0.6);
        box-shadow: 0 30px 60px -20px rgba(0, 0, 0, 0.2);
        position: relative;
        overflow: hidden;
        animation: slideInRight 0.6s ease-out;
    }

    .cohort-header::before {
        content: '';
        position: absolute;
        top: -30%;
        right: -20%;
        width: 400px;
        height: 400px;
        background: radial-gradient(circle, rgba(99, 102, 241, 0.08) 0%, transparent 70%);
        border-radius: 50%;
        pointer-events: none;
        animation: float 20s ease-in-out infinite;
    }

    .cohort-header::after {
        content: '';
        position: absolute;
        bottom: -30%;
        left: -20%;
        width: 400px;
        height: 400px;
        background: radial-gradient(circle, rgba(139, 92, 246, 0.08) 0%, transparent 70%);
        border-radius: 50%;
        pointer-events: none;
        animation: float 25s ease-in-out infinite reverse;
    }

    @keyframes float {
        0%, 100% { transform: translate(0, 0) scale(1); }
        50% { transform: translate(30px, -20px) scale(1.1); }
    }

    .cohort-title {
        font-size: 2.8rem;
        font-weight: 800;
        background: linear-gradient(145deg, #1e293b, #0f172a);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .cohort-title i {
        background: linear-gradient(135deg, var(--cohort-primary), var(--cohort-secondary));
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        animation: pulse 3s ease-in-out infinite;
    }

    @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }

    .cohort-subtitle {
        color: #475569;
        font-size: 1.2rem;
        max-width: 700px;
    }

    /* ===== CONTROL PANEL ===== */
    .control-panel {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 20px;
        margin-bottom: 30px;
        padding: 20px 30px;
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(16px);
        border-radius: 32px;
        border: 1px solid rgba(255, 255, 255, 0.6);
        animation: slideInRight 0.6s ease-out 0.1s both;
    }

    .date-range {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .date-badge {
        padding: 10px 24px;
        background: white;
        border-radius: 50px;
        border: 1px solid #e2e8f0;
        color: #1e293b;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: all 0.3s ease;
    }

    .date-badge i {
        color: var(--cohort-primary);
    }

    .date-badge:hover {
        border-color: var(--cohort-primary);
        box-shadow: 0 8px 15px -8px rgba(99, 102, 241, 0.2);
        transform: translateY(-2px);
    }

    .cohort-selector {
        display: flex;
        gap: 10px;
    }

    .cohort-btn {
        padding: 10px 24px;
        background: white;
        border: 1px solid #e2e8f0;
        border-radius: 50px;
        color: #475569;
        font-weight: 600;
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .cohort-btn.active {
        background: linear-gradient(135deg, var(--cohort-primary), var(--cohort-secondary));
        color: white;
        border-color: transparent;
    }

    .cohort-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 15px -8px rgba(99, 102, 241, 0.2);
    }

    /* ===== SUMMARY CARDS ===== */
    .summary-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
        margin-bottom: 40px;
    }

    .summary-card {
        background: rgba(255, 255, 255, 0.92);
        backdrop-filter: blur(16px);
        border-radius: 28px;
        padding: 25px;
        border: 1px solid rgba(255, 255, 255, 0.6);
        transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        display: flex;
        align-items: center;
        gap: 20px;
        animation: slideInRight 0.6s ease-out;
        animation-fill-mode: both;
    }

    .summary-card:nth-child(1) { animation-delay: 0.15s; }
    .summary-card:nth-child(2) { animation-delay: 0.2s; }
    .summary-card:nth-child(3) { animation-delay: 0.25s; }
    .summary-card:nth-child(4) { animation-delay: 0.3s; }

    .summary-card:hover {
        transform: translateY(-5px) scale(1.02);
        background: white;
        box-shadow: 0 25px 40px -15px rgba(99, 102, 241, 0.2);
        border-color: var(--cohort-primary);
    }

    .summary-icon {
        width: 60px;
        height: 60px;
        border-radius: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.8rem;
        color: white;
    }

    .summary-content {
        flex: 1;
    }

    .summary-label {
        font-size: 0.85rem;
        color: #64748b;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-weight: 600;
        margin-bottom: 5px;
    }

    .summary-value {
        font-size: 1.8rem;
        font-weight: 800;
        color: #0f172a;
        line-height: 1;
        margin-bottom: 5px;
    }

    .summary-trend {
        font-size: 0.8rem;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .trend-up { color: var(--cohort-success); }
    .trend-down { color: var(--cohort-danger); }

    /* ===== COHORT MATRIX ===== */
    .matrix-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-radius: 40px;
        padding: 35px;
        margin-bottom: 40px;
        border: 1px solid rgba(255, 255, 255, 0.6);
        box-shadow: 0 30px 50px -20px rgba(0, 0, 0, 0.15);
        animation: slideInRight 0.6s ease-out 0.35s both;
    }

    .matrix-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 30px;
    }

    .matrix-header h3 {
        font-size: 1.5rem;
        font-weight: 700;
        color: #0f172a;
        display: flex;
        align-items: center;
        gap: 12px;
        margin: 0;
    }

    .matrix-header h3 i {
        color: var(--cohort-primary);
        background: rgba(99, 102, 241, 0.1);
        padding: 10px;
        border-radius: 14px;
    }

    .legend {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
    }

    .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.85rem;
        color: #475569;
    }

    .legend-color {
        width: 16px;
        height: 16px;
        border-radius: 6px;
    }

    .color-excellent { background: #10b981; }
    .color-good { background: #3b82f6; }
    .color-average { background: #f59e0b; }
    .color-poor { background: #ef4444; }

    /* ===== COHORT TABLE ===== */
    .cohort-table-container {
        overflow-x: auto;
        border-radius: 24px;
    }

    .cohort-table {
        width: 100%;
        border-collapse: collapse;
        min-width: 800px;
    }

    .cohort-table th {
        padding: 16px 12px;
        background: #f8fafc;
        color: #1e293b;
        font-weight: 700;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        text-align: center;
        border-bottom: 2px solid #e2e8f0;
    }

    .cohort-table td {
        padding: 14px 12px;
        text-align: center;
        border: 1px solid #f1f5f9;
        font-weight: 600;
        transition: all 0.2s ease;
    }

    .cohort-table tr:hover td {
        background: rgba(99, 102, 241, 0.02);
    }

    .cohort-month {
        font-weight: 700;
        color: #0f172a;
        background: #f8fafc;
        text-align: left !important;
    }

    .cohort-size {
        font-weight: 700;
        color: #6366f1;
        background: #f8fafc;
    }

    .retention-cell {
        position: relative;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .retention-cell:hover {
        transform: scale(1.1);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        z-index: 10;
        border-radius: 8px;
    }

    .retention-high {
        background: rgba(16, 185, 129, 0.15);
        color: #065f46;
        font-weight: 700;
    }

    .retention-good {
        background: rgba(59, 130, 246, 0.15);
        color: #1e40af;
        font-weight: 700;
    }

    .retention-medium {
        background: rgba(245, 158, 11, 0.15);
        color: #92400e;
        font-weight: 700;
    }

    .retention-low {
        background: rgba(239, 68, 68, 0.15);
        color: #991b1b;
        font-weight: 700;
    }

    /* ===== COHORT CHART ===== */
    .chart-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-radius: 40px;
        padding: 30px;
        margin-bottom: 40px;
        border: 1px solid rgba(255, 255, 255, 0.6);
        box-shadow: 0 30px 50px -20px rgba(0, 0, 0, 0.15);
        animation: slideInRight 0.6s ease-out 0.4s both;
    }

    .chart-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 25px;
    }

    .chart-header h3 {
        font-size: 1.3rem;
        font-weight: 700;
        color: #0f172a;
        display: flex;
        align-items: center;
        gap: 12px;
        margin: 0;
    }

    .chart-container {
        height: 300px;
        position: relative;
    }

    /* ===== INSIGHTS CARD ===== */
    .insights-card {
        background: linear-gradient(145deg, rgba(99, 102, 241, 0.08), rgba(139, 92, 246, 0.08));
        backdrop-filter: blur(20px);
        border-radius: 40px;
        padding: 35px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        animation: slideInRight 0.6s ease-out 0.45s both;
    }

    .insights-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 30px;
    }

    .insight-item {
        display: flex;
        gap: 20px;
        align-items: flex-start;
    }

    .insight-icon {
        width: 50px;
        height: 50px;
        background: white;
        border-radius: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: var(--cohort-primary);
        box-shadow: 0 10px 20px -8px rgba(0, 0, 0, 0.05);
    }

    .insight-content h4 {
        font-size: 1.1rem;
        font-weight: 700;
        color: #0f172a;
        margin-bottom: 5px;
    }

    .insight-content p {
        color: #475569;
        font-size: 0.95rem;
        margin: 0;
        line-height: 1.6;
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 1200px) {
        .summary-grid { grid-template-columns: repeat(2, 1fr); }
        .insights-grid { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 992px) {
        .cohort-title { font-size: 2.2rem; }
        .control-panel { flex-direction: column; align-items: flex-start; }
        .insights-grid { grid-template-columns: 1fr; }
    }

    @media (max-width: 768px) {
        .cohort-header { padding: 30px; }
        .cohort-title { font-size: 1.8rem; flex-direction: column; }
        .summary-grid { grid-template-columns: 1fr; }
        .matrix-header { flex-direction: column; align-items: flex-start; gap: 15px; }
        .insight-item { flex-direction: column; text-align: center; }
        .insight-icon { margin: 0 auto; }
    }

    /* ===== DARK MODE ===== */
    @media (prefers-color-scheme: dark) {
        .cohort-header,
        .matrix-card,
        .chart-card,
        .summary-card,
        .control-panel {
            background: rgba(15, 23, 42, 0.92);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .cohort-title {
            background: linear-gradient(145deg, #f1f5f9, #e2e8f0);
            -webkit-background-clip: text;
            background-clip: text;
        }

        .cohort-subtitle {
            color: #cbd5e1;
        }

        .summary-value,
        .matrix-header h3,
        .chart-header h3,
        .insight-content h4 {
            color: #f1f5f9;
        }

        .summary-label,
        .legend-item,
        .insight-content p {
            color: #94a3b8;
        }

        .cohort-table th {
            background: #1e293b;
            color: #e2e8f0;
            border-bottom-color: #334155;
        }

        .cohort-table td {
            border-color: #334155;
            color: #cbd5e1;
        }

        .cohort-month {
            background: #1e293b;
            color: #f1f5f9;
        }

        .cohort-size {
            background: #1e293b;
        }

        .date-badge,
        .cohort-btn {
            background: #1e293b;
            border-color: #334155;
            color: #e2e8f0;
        }

        .insight-icon {
            background: #1e293b;
            color: #a5b4fc;
        }

        .insights-card {
            background: linear-gradient(145deg, rgba(99, 102, 241, 0.15), rgba(139, 92, 246, 0.15));
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="cohort-wrapper">
    
    <!-- ===== HEADER ===== -->
    <div class="cohort-header">
        <h1 class="cohort-title">
            <i class="fas fa-table"></i>
            Cohort Analysis
        </h1>
        <p class="cohort-subtitle">
            Track customer retention patterns across cohorts and optimize your retention strategies
        </p>
    </div>

    <!-- ===== CONTROL PANEL ===== -->
    <div class="control-panel">
        <div class="date-range">
            <span class="date-badge">
                <i class="fas fa-calendar"></i>
                Jan 2025 - Jan 2026
            </span>
            <span class="date-badge">
                <i class="fas fa-chart-line"></i>
                Last 12 Months
            </span>
        </div>
        <div class="cohort-selector">
            <span class="cohort-btn active">Monthly</span>
            <span class="cohort-btn">Quarterly</span>
            <span class="cohort-btn">Weekly</span>
        </div>
    </div>

    <!-- ===== SUMMARY CARDS ===== -->
    <div class="summary-grid">
        <div class="summary-card">
            <div class="summary-icon" style="background: linear-gradient(135deg, #6366f1, #8b5cf6);">
                <i class="fas fa-users"></i>
            </div>
            <div class="summary-content">
                <div class="summary-label">Avg. Cohort Size</div>
                <div class="summary-value">1,284</div>
                <div class="summary-trend trend-up">
                    <i class="fas fa-arrow-up"></i> +5.2% vs last year
                </div>
            </div>
        </div>

        <div class="summary-card">
            <div class="summary-icon" style="background: linear-gradient(135deg, #10b981, #34d399);">
                <i class="fas fa-chart-line"></i>
            </div>
            <div class="summary-content">
                <div class="summary-label">Retention (M1)</div>
                <div class="summary-value">67%</div>
                <div class="summary-trend trend-up">
                    <i class="fas fa-arrow-up"></i> +2.3% vs last year
                </div>
            </div>
        </div>

        <div class="summary-card">
            <div class="summary-icon" style="background: linear-gradient(135deg, #f59e0b, #fbbf24);">
                <i class="fas fa-clock"></i>
            </div>
            <div class="summary-content">
                <div class="summary-label">Avg. Lifetime</div>
                <div class="summary-value">8.3 mo</div>
                <div class="summary-trend trend-up">
                    <i class="fas fa-arrow-up"></i> +0.8 mo
                </div>
            </div>
        </div>

        <div class="summary-card">
            <div class="summary-icon" style="background: linear-gradient(135deg, #ef4444, #f87171);">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="summary-content">
                <div class="summary-label">Churn Rate</div>
                <div class="summary-value">5.2%</div>
                <div class="summary-trend trend-down">
                    <i class="fas fa-arrow-down"></i> -0.7% vs last year
                </div>
            </div>
        </div>
    </div>

    <!-- ===== COHORT RETENTION MATRIX ===== -->
    <div class="matrix-card">
        <div class="matrix-header">
            <h3>
                <i class="fas fa-border-all"></i>
                Customer Retention Matrix
            </h3>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color color-excellent"></div>
                    <span>Excellent (>70%)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color color-good"></div>
                    <span>Good (50-70%)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color color-average"></div>
                    <span>Average (30-50%)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color color-poor"></div>
                    <span>Poor (<30%)</span>
                </div>
            </div>
        </div>

        <div class="cohort-table-container">
            <table class="cohort-table">
                <thead>
                    <tr>
                        <th>Cohort</th>
                        <th>Size</th>
                        <th>M1</th>
                        <th>M2</th>
                        <th>M3</th>
                        <th>M4</th>
                        <th>M5</th>
                        <th>M6</th>
                        <th>M7</th>
                        <th>M8</th>
                        <th>M9</th>
                        <th>M10</th>
                        <th>M11</th>
                        <th>M12</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="cohort-month">Jan 2026</td>
                        <td class="cohort-size">1,450</td>
                        <td class="retention-cell retention-high">72%</td>
                        <td class="retention-cell retention-high">68%</td>
                        <td class="retention-cell retention-high">65%</td>
                        <td class="retention-cell retention-good">58%</td>
                        <td class="retention-cell retention-good">52%</td>
                        <td class="retention-cell retention-good">48%</td>
                        <td class="retention-cell retention-good">45%</td>
                        <td class="retention-cell retention-medium">42%</td>
                        <td class="retention-cell retention-medium">38%</td>
                        <td class="retention-cell retention-medium">35%</td>
                        <td class="retention-cell retention-medium">32%</td>
                        <td class="retention-cell retention-low">30%</td>
                    </tr>
                    <tr>
                        <td class="cohort-month">Feb 2026</td>
                        <td class="cohort-size">1,380</td>
                        <td class="retention-cell retention-high">71%</td>
                        <td class="retention-cell retention-high">67%</td>
                        <td class="retention-cell retention-good">61%</td>
                        <td class="retention-cell retention-good">55%</td>
                        <td class="retention-cell retention-good">50%</td>
                        <td class="retention-cell retention-good">47%</td>
                        <td class="retention-cell retention-good">44%</td>
                        <td class="retention-cell retention-medium">39%</td>
                        <td class="retention-cell retention-medium">36%</td>
                        <td class="retention-cell retention-medium">33%</td>
                        <td class="retention-cell retention-low">31%</td>
                        <td class="retention-cell">-</td>
                    </tr>
                    <tr>
                        <td class="cohort-month">Mar 2026</td>
                        <td class="cohort-size">1,520</td>
                        <td class="retention-cell retention-high">74%</td>
                        <td class="retention-cell retention-high">70%</td>
                        <td class="retention-cell retention-high">66%</td>
                        <td class="retention-cell retention-good">60%</td>
                        <td class="retention-cell retention-good">54%</td>
                        <td class="retention-cell retention-good">49%</td>
                        <td class="retention-cell retention-good">45%</td>
                        <td class="retention-cell retention-medium">41%</td>
                        <td class="retention-cell retention-medium">37%</td>
                        <td class="retention-cell retention-medium">34%</td>
                        <td class="retention-cell">-</td>
                        <td class="retention-cell">-</td>
                    </tr>
                    <tr>
                        <td class="cohort-month">Apr 2026</td>
                        <td class="cohort-size">1,290</td>
                        <td class="retention-cell retention-good">69%</td>
                        <td class="retention-cell retention-good">64%</td>
                        <td class="retention-cell retention-good">58%</td>
                        <td class="retention-cell retention-good">52%</td>
                        <td class="retention-cell retention-good">47%</td>
                        <td class="retention-cell retention-medium">43%</td>
                        <td class="retention-cell retention-medium">39%</td>
                        <td class="retention-cell retention-medium">35%</td>
                        <td class="retention-cell retention-low">32%</td>
                        <td class="retention-cell">-</td>
                        <td class="retention-cell">-</td>
                        <td class="retention-cell">-</td>
                    </tr>
                    <tr>
                        <td class="cohort-month">May 2026</td>
                        <td class="cohort-size">1,410</td>
                        <td class="retention-cell retention-good">68%</td>
                        <td class="retention-cell retention-good">62%</td>
                        <td class="retention-cell retention-good">56%</td>
                        <td class="retention-cell retention-good">51%</td>
                        <td class="retention-cell retention-good">46%</td>
                        <td class="retention-cell retention-medium">42%</td>
                        <td class="retention-cell retention-medium">38%</td>
                        <td class="retention-cell retention-medium">34%</td>
                        <td class="retention-cell">-</td>
                        <td class="retention-cell">-</td>
                        <td class="retention-cell">-</td>
                        <td class="retention-cell">-</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- ===== COHORT TRENDS CHART ===== -->
    <div class="chart-card">
        <div class="chart-header">
            <h3>
                <i class="fas fa-chart-line"></i>
                12-Month Retention Trends
            </h3>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #6366f1;"></div>
                    <span>Jan 2026</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #8b5cf6;"></div>
                    <span>Feb 2026</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #ec4899;"></div>
                    <span>Mar 2026</span>
                </div>
            </div>
        </div>
        <div class="chart-container">
            <canvas id="cohortTrendChart"></canvas>
        </div>
    </div>

    <!-- ===== KEY INSIGHTS ===== -->
    <div class="insights-card">
        <div class="insights-grid">
            <div class="insight-item">
                <div class="insight-icon">
                    <i class="fas fa-trend-up"></i>
                </div>
                <div class="insight-content">
                    <h4>üìà Best Performing Cohort</h4>
                    <p>March 2026 cohort shows strongest retention with 74% M1 retention and 45% at M6.</p>
                </div>
            </div>
            <div class="insight-item">
                <div class="insight-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="insight-content">
                    <h4>‚ö†Ô∏è Critical Drop-off</h4>
                    <p>Average retention drops 23% between M1 and M3. Focus on early engagement.</p>
                </div>
            </div>
            <div class="insight-item">
                <div class="insight-icon">
                    <i class="fas fa-lightbulb"></i>
                </div>
                <div class="insight-content">
                    <h4>üí° Recommendation</h4>
                    <p>Launch re-engagement campaign at M2 to improve long-term retention.</p>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- ===== CHARTS.JS INITIALIZATION ===== -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Cohort Trends Chart
        const ctx = document.getElementById('cohortTrendChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['M1', 'M2', 'M3', 'M4', 'M5', 'M6', 'M7', 'M8', 'M9', 'M10', 'M11', 'M12'],
                datasets: [
                    {
                        label: 'Jan 2026',
                        data: [72, 68, 65, 58, 52, 48, 45, 42, 38, 35, 32, 30],
                        borderColor: '#6366f1',
                        backgroundColor: 'rgba(99, 102, 241, 0.05)',
                        borderWidth: 3,
                        pointBackgroundColor: '#6366f1',
                        pointBorderColor: 'white',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        tension: 0.3,
                        fill: true
                    },
                    {
                        label: 'Feb 2026',
                        data: [71, 67, 61, 55, 50, 47, 44, 39, 36, 33, 31, null],
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.05)',
                        borderWidth: 3,
                        pointBackgroundColor: '#8b5cf6',
                        pointBorderColor: 'white',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        tension: 0.3,
                        fill: true,
                        spanGaps: true
                    },
                    {
                        label: 'Mar 2026',
                        data: [74, 70, 66, 60, 54, 49, 45, 41, 37, 34, null, null],
                        borderColor: '#ec4899',
                        backgroundColor: 'rgba(236, 72, 153, 0.05)',
                        borderWidth: 3,
                        pointBackgroundColor: '#ec4899',
                        pointBorderColor: 'white',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        tension: 0.3,
                        fill: true,
                        spanGaps: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'bottom',
                        labels: {
                            usePointStyle: true,
                            pointStyle: 'circle',
                            padding: 20,
                            font: { size: 12, weight: '500' }
                        }
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        backgroundColor: 'rgba(15, 23, 42, 0.95)',
                        titleColor: '#fff',
                        bodyColor: '#e2e8f0',
                        borderColor: 'rgba(255, 255, 255, 0.1)',
                        borderWidth: 1,
                        padding: 12,
                        cornerRadius: 8
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        grid: { color: 'rgba(203, 213, 225, 0.2)' },
                        title: {
                            display: true,
                            text: 'Retention Rate (%)',
                            color: '#64748b',
                            font: { size: 12, weight: '600' }
                        }
                    },
                    x: {
                        grid: { display: false },
                        title: {
                            display: true,
                            text: 'Months Since Acquisition',
                            color: '#64748b',
                            font: { size: 12, weight: '600' }
                        }
                    }
                }
            }
        });
    });
</script>
{% endblock %}

{% block extra_js %}{% endblock %}