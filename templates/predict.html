{% extends "base.html" %}
{% block title %}Predict Churn{% endblock %}

{% block content %}
<div class="card p-4 shadow">

    <h1 class="title text-center mb-3">Customer Churn Prediction</h1>
    <p class="subtitle text-center mb-4">ML-powered churn risk analysis</p>

    <form method="post" action="{{ url_for('predict_datapoint') }}" onsubmit="showLoader()">

        <!-- ================= Customer Profile ================= -->
        <h3 class="section">üë§ Customer Profile</h3>
        <div class="form-grid row g-3">
            <div class="col-md-6">
                <input type="number" name="age" class="form-control" placeholder="Age (e.g. 30)" required>
            </div>

            <div class="col-md-6">
                <select name="gender" class="form-select" required>
                    <option value="" disabled selected>Select Gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                </select>
            </div>

            <div class="col-md-6">
                <input type="number" name="weekly_active_days" class="form-control" placeholder="Weekly Active Days (0‚Äì7)" required>
            </div>

            <div class="col-md-6">
                <input type="number" step="0.1" name="avg_session_time" class="form-control" placeholder="Avg Session Time (minutes)" required>
            </div>

            <div class="col-md-6">
                <input type="number" step="0.01" name="total_revenue" class="form-control" placeholder="Total Revenue (‚Çπ)" required>
            </div>

            <div class="col-md-6">
                <input type="number" name="payment_failures" class="form-control" placeholder="Payment Failures" required>
            </div>

            <div class="col-md-6">
                <select name="contract_type" class="form-select" required>
                    <option value="" disabled selected>Select Contract Type</option>
                    <option value="Monthly">Monthly</option>
                    <option value="Yearly">Yearly</option>
                </select>
            </div>

            <div class="col-md-6">
                <select name="payment_method" class="form-select" required>
                    <option value="" disabled selected>Select Payment Method</option>
                    <option value="Card">Card</option>
                    <option value="PayPal">PayPal</option>
                    <option value="Bank Transfer">Bank Transfer</option>
                </select>
            </div>

            <div class="col-md-6">
                <select name="complaint_type" class="form-select">
                    <option value="No Complaint" selected>No Complaint</option>
                    <option value="Billing">Billing Issue</option>
                    <option value="Service">Service Issue</option>
                    <option value="Technical">Technical Issue</option>
                </select>
            </div>
        </div>

        <!-- ================= Usage Behavior ================= -->
        <h3 class="section mt-4">üìä Usage Behavior</h3>
        <div class="form-grid row g-3">
            <div class="col-md-6">
                <input type="number" name="tenure_months" class="form-control" placeholder="Tenure (months)">
            </div>
            <div class="col-md-6">
                <input type="number" name="monthly_logins" class="form-control" placeholder="Monthly Logins">
            </div>
        </div>

        <!-- ================= Billing & Support ================= -->
        <h3 class="section mt-4">üí≥ Billing & Support</h3>
        <div class="form-grid row g-3">
            <div class="col-md-6">
                <input type="number" step="0.01" name="monthly_fee" class="form-control" placeholder="Monthly Fee (‚Çπ)">
            </div>
            <div class="col-md-6">
                <input type="number" name="support_tickets" class="form-control" placeholder="Support Tickets Raised">
            </div>
        </div>

        <!-- ================= Feedback ================= -->
        <h3 class="section mt-4">‚≠ê Customer Feedback</h3>
        <div class="form-grid row g-3">
            <div class="col-md-6">
                <input type="number" min="1" max="5" name="csat_score" class="form-control" placeholder="CSAT Score (1‚Äì5)">
            </div>
            <div class="col-md-6">
                <input type="number" name="nps_score" class="form-control" placeholder="NPS Score">
            </div>
        </div>

        <!-- ================= Submit Button ================= -->
        <button type="submit" class="btn btn-primary w-100 mt-4">üîç Predict Churn</button>

        <!-- Loader -->
        <div id="loader" class="text-center mt-3" style="display:none;">
            <div class="spinner-border text-primary"></div>
            <p>Processing Prediction...</p>
        </div>

    </form>

    <!-- ================= Result ================= -->
    {% if results %}
        {% if results == "Churn" %}
            <div class="alert alert-danger mt-4 text-center">
                ‚ö† Customer is Likely to Churn
            </div>
        {% else %}
            <div class="alert alert-success mt-4 text-center">
                ‚úÖ Customer is Not Likely to Churn
            </div>
        {% endif %}
    {% endif %}

</div>
{% endblock %}

{% block extra_js %}
<script>
function showLoader(){
    document.getElementById("loader").style.display = "block";
}
</script>
{% endblock %}
