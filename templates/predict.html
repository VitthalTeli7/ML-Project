{% extends "base.html" %}

{% block title %}Predict Churn | ChurnAI - Enterprise ML Platform{% endblock %}

{% block extra_css %}
<style>
    /* =====================================================
       PREDICT PAGE - PREMIUM ENTERPRISE EDITION
       Glassmorphism | 3D Effects | Micro-interactions
       Dark Mode Ready | Fully Responsive
       Preserved Backend Logic | Enhanced UI/UX
       ===================================================== */

    :root {
        --predict-primary: #6366f1;
        --predict-secondary: #8b5cf6;
        --predict-accent: #ec4899;
        --predict-success: #10b981;
        --predict-warning: #f59e0b;
        --predict-danger: #ef4444;
        --predict-dark: #0f172a;
        --predict-light: #f8fafc;
    }

    .predict-wrapper {
        padding: 30px 0 60px;
        animation: fadeIn 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideInRight {
        from { opacity: 0; transform: translateX(30px); }
        to { opacity: 1; transform: translateX(0); }
    }

    @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }

    /* ===== PREMIUM PREDICTION CARD ===== */
    .predict-card {
        background: rgba(255, 255, 255, 0.92);
        backdrop-filter: blur(24px) saturate(180%);
        -webkit-backdrop-filter: blur(24px) saturate(180%);
        border: 1px solid rgba(255, 255, 255, 0.6);
        border-radius: 64px;
        padding: 60px;
        max-width: 1300px;
        margin: 0 auto;
        box-shadow: 0 50px 100px -30px rgba(0, 0, 0, 0.25),
                    0 0 0 1px rgba(255, 255, 255, 0.5) inset;
        position: relative;
        overflow: hidden;
        transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .predict-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 60px 120px -30px rgba(99, 102, 241, 0.3),
                    0 0 0 1px rgba(255, 255, 255, 0.7) inset;
        background: rgba(255, 255, 255, 0.96);
    }

    /* Animated gradient orbs */
    .predict-card::before {
        content: '';
        position: absolute;
        top: -30%;
        right: -20%;
        width: 500px;
        height: 500px;
        background: radial-gradient(circle, rgba(99, 102, 241, 0.08) 0%, transparent 70%);
        border-radius: 50%;
        pointer-events: none;
        animation: floatOrb 20s ease-in-out infinite;
    }

    .predict-card::after {
        content: '';
        position: absolute;
        bottom: -30%;
        left: -20%;
        width: 500px;
        height: 500px;
        background: radial-gradient(circle, rgba(139, 92, 246, 0.08) 0%, transparent 70%);
        border-radius: 50%;
        pointer-events: none;
        animation: floatOrb 25s ease-in-out infinite reverse;
    }

    @keyframes floatOrb {
        0%, 100% { transform: translate(0, 0) scale(1); }
        50% { transform: translate(30px, -20px) scale(1.1); }
    }

    /* ===== PREMIUM HEADER ===== */
    .predict-header {
        text-align: center;
        margin-bottom: 50px;
        position: relative;
        z-index: 10;
        animation: slideInRight 0.6s ease-out;
    }

    .predict-header h1 {
        font-size: 3.2rem;
        font-weight: 800;
        background: linear-gradient(145deg, #1e293b, #0f172a);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
        letter-spacing: -0.02em;
    }

    .predict-header h1 i {
        background: linear-gradient(135deg, var(--predict-primary), var(--predict-secondary));
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        animation: pulse 3s ease-in-out infinite;
    }

    .predict-header p {
        font-size: 1.2rem;
        color: #475569;
        max-width: 700px;
        margin: 0 auto;
        position: relative;
        padding-bottom: 20px;
    }

    .predict-header p::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 100px;
        height: 4px;
        background: linear-gradient(90deg, var(--predict-primary), var(--predict-secondary), var(--predict-accent));
        border-radius: 4px;
        animation: expandWidth 1.2s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    @keyframes expandWidth {
        from { width: 0; opacity: 0; }
        to { width: 100px; opacity: 1; }
    }

    /* ===== PREMIUM SECTION HEADERS ===== */
    .section {
        display: flex;
        align-items: center;
        gap: 15px;
        font-size: 1.4rem;
        font-weight: 700;
        color: #0f172a;
        margin: 50px 0 30px 0;
        padding-bottom: 15px;
        border-bottom: 3px solid rgba(99, 102, 241, 0.2);
        position: relative;
        animation: slideInRight 0.6s ease-out;
        animation-fill-mode: both;
    }

    .section:nth-of-type(1) { animation-delay: 0.1s; }
    .section:nth-of-type(2) { animation-delay: 0.2s; }
    .section:nth-of-type(3) { animation-delay: 0.3s; }
    .section:nth-of-type(4) { animation-delay: 0.4s; }

    .section i {
        color: white;
        font-size: 1.6rem;
        background: linear-gradient(135deg, var(--predict-primary), var(--predict-secondary));
        padding: 12px;
        border-radius: 18px;
        box-shadow: 0 10px 20px -8px rgba(99, 102, 241, 0.3);
        transition: all 0.3s ease;
    }

    .section:hover i {
        transform: rotate(5deg) scale(1.1);
        box-shadow: 0 15px 30px -8px rgba(99, 102, 241, 0.4);
    }

    /* ===== PREMIUM FORM GRID ===== */
    .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 25px;
        animation: fadeIn 0.8s ease-out;
        animation-fill-mode: both;
    }

    .form-grid > div {
        animation: slideInRight 0.6s ease-out;
        animation-fill-mode: both;
    }

    .form-grid > div:nth-child(1) { animation-delay: 0.15s; }
    .form-grid > div:nth-child(2) { animation-delay: 0.2s; }
    .form-grid > div:nth-child(3) { animation-delay: 0.25s; }
    .form-grid > div:nth-child(4) { animation-delay: 0.3s; }
    .form-grid > div:nth-child(5) { animation-delay: 0.35s; }
    .form-grid > div:nth-child(6) { animation-delay: 0.4s; }
    .form-grid > div:nth-child(7) { animation-delay: 0.45s; }
    .form-grid > div:nth-child(8) { animation-delay: 0.5s; }
    .form-grid > div:nth-child(9) { animation-delay: 0.55s; }

    /* ===== PREMIUM FORM LABELS ===== */
    .form-label {
        font-weight: 700;
        color: #1e293b;
        margin-bottom: 10px;
        margin-left: 5px;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.95rem;
        letter-spacing: 0.3px;
    }

    .form-label i {
        color: var(--predict-primary);
        font-size: 1rem;
    }

    /* ===== PREMIUM FORM CONTROLS ===== */
    .form-control, .form-select {
        background: rgba(247, 250, 252, 0.9);
        border: 2px solid #e2e8f0;
        border-radius: 20px;
        padding: 16px 22px;
        font-size: 1rem;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        color: #0f172a;
        font-weight: 500;
        width: 100%;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.02);
    }

    .form-control:focus, .form-select:focus {
        border-color: var(--predict-primary);
        box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.15), 0 8px 12px -4px rgba(99, 102, 241, 0.1);
        background: white;
        outline: none;
        transform: translateY(-2px);
    }

    .form-control:hover, .form-select:hover {
        border-color: var(--predict-secondary);
        background: white;
        box-shadow: 0 8px 12px -4px rgba(99, 102, 241, 0.1);
    }

    .form-control::placeholder {
        color: #94a3b8;
        font-weight: 400;
    }

    /* ===== PREMIUM SUBMIT BUTTON ===== */
    .btn-predict-submit {
        background: linear-gradient(135deg, var(--predict-primary), var(--predict-secondary), var(--predict-accent));
        background-size: 200% 200%;
        border: none;
        border-radius: 60px;
        padding: 20px 40px;
        font-size: 1.3rem;
        font-weight: 700;
        color: white;
        letter-spacing: 1px;
        box-shadow: 0 20px 35px -8px rgba(99, 102, 241, 0.5);
        transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        margin-top: 50px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
        position: relative;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.2);
        width: auto;
        min-width: 350px;
    }

    .btn-predict-submit::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
    }

    .btn-predict-submit:hover {
        background-position: 100% 50%;
        transform: translateY(-8px) scale(1.05);
        box-shadow: 0 30px 45px -8px rgba(99, 102, 241, 0.7);
        color: white;
    }

    .btn-predict-submit:hover::before {
        width: 300px;
        height: 300px;
    }

    .btn-predict-submit i {
        font-size: 1.3rem;
        transition: all 0.3s ease;
    }

    .btn-predict-submit:hover i {
        transform: translateX(8px) rotate(5deg);
    }

    /* ===== PREMIUM LOADER ===== */
    .loader {
        display: none;
        margin-top: 40px;
        text-align: center;
        animation: fadeIn 0.5s ease;
    }

    .spinner {
        width: 70px;
        height: 70px;
        margin: 0 auto 20px;
        border: 5px solid rgba(99, 102, 241, 0.1);
        border-top: 5px solid var(--predict-primary);
        border-right: 5px solid var(--predict-secondary);
        border-bottom: 5px solid var(--predict-accent);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        box-shadow: 0 0 20px rgba(99, 102, 241, 0.2);
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .loader p {
        color: var(--predict-primary);
        font-weight: 700;
        font-size: 1.1rem;
        letter-spacing: 1px;
        animation: pulse 2s infinite;
    }

    /* ===== PREMIUM RESULT ALERTS ===== */
    .alert {
        border-radius: 40px;
        padding: 30px 35px;
        font-size: 1.2rem;
        font-weight: 600;
        border: none;
        margin-top: 50px;
        animation: slideInRight 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 20px;
        box-shadow: 0 20px 35px -10px rgba(0, 0, 0, 0.1);
        border-left: 8px solid;
        position: relative;
        overflow: hidden;
    }

    .alert::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -20%;
        width: 200px;
        height: 200px;
        background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 70%);
        border-radius: 50%;
        pointer-events: none;
    }

    .alert-success {
        background: linear-gradient(145deg, #f0fdf4, #dcfce7);
        color: #166534;
        border-left-color: #22c55e;
    }

    .alert-danger {
        background: linear-gradient(145deg, #fef2f2, #fee2e2);
        color: #991b1b;
        border-left-color: #ef4444;
    }

    .alert i {
        font-size: 2rem;
    }

    @keyframes slideIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* ===== FORM FOOTER ===== */
    .form-footer {
        margin-top: 30px;
        text-align: center;
        color: #64748b;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 20px;
        flex-wrap: wrap;
    }

    .form-footer i {
        color: var(--predict-primary);
    }

    /* ===== RESPONSIVE DESIGN ===== */
    @media (max-width: 1200px) {
        .predict-card { padding: 50px; }
        .predict-header h1 { font-size: 2.8rem; }
    }

    @media (max-width: 992px) {
        .predict-card { padding: 40px; border-radius: 48px; }
        .predict-header h1 { font-size: 2.5rem; }
        .section { font-size: 1.2rem; }
        .btn-predict-submit { min-width: 300px; }
    }

    @media (max-width: 768px) {
        .predict-card { 
            padding: 30px 25px; 
            border-radius: 40px;
        }
        .predict-header h1 { 
            font-size: 2rem; 
            flex-direction: column;
        }
        .predict-header p { font-size: 1.1rem; }
        .section { 
            font-size: 1.1rem; 
            margin: 40px 0 25px;
        }
        .section i { 
            font-size: 1.3rem; 
            padding: 10px;
        }
        .form-grid { gap: 15px; }
        .form-control, .form-select { 
            padding: 14px 18px; 
            font-size: 0.95rem;
        }
        .btn-predict-submit {
            min-width: 100%;
            padding: 16px 30px;
            font-size: 1.1rem;
        }
        .alert { 
            flex-direction: column; 
            text-align: center;
            padding: 25px;
        }
    }

    @media (max-width: 576px) {
        .predict-card { padding: 25px 20px; }
        .predict-header h1 { font-size: 1.8rem; }
        .section { 
            font-size: 1rem;
            gap: 10px;
        }
        .form-label { font-size: 0.9rem; }
    }

    /* ===== DARK MODE ===== */
    @media (prefers-color-scheme: dark) {
        .predict-card {
            background: rgba(15, 23, 42, 0.92);
            border-color: rgba(255, 255, 255, 0.1);
        }
        .predict-card:hover {
            background: rgba(15, 23, 42, 0.96);
        }
        .predict-header h1 {
            background: linear-gradient(145deg, #f1f5f9, #e2e8f0);
            -webkit-background-clip: text;
            background-clip: text;
        }
        .predict-header p {
            color: #cbd5e1;
        }
        .section {
            color: #f1f5f9;
            border-bottom-color: rgba(99, 102, 241, 0.3);
        }
        .form-label {
            color: #e2e8f0;
        }
        .form-control, .form-select {
            background: rgba(30, 41, 59, 0.9);
            border-color: #334155;
            color: #f1f5f9;
        }
        .form-control:focus, .form-select:focus {
            background: #1e293b;
        }
        .form-control::placeholder {
            color: #64748b;
        }
        .alert-success {
            background: linear-gradient(145deg, rgba(34, 197, 94, 0.1), rgba(34, 197, 94, 0.05));
            color: #bbf7d0;
        }
        .alert-danger {
            background: linear-gradient(145deg, rgba(239, 68, 68, 0.1), rgba(239, 68, 68, 0.05));
            color: #fecaca;
        }
        .form-footer {
            color: #94a3b8;
        }
    }

    /* ===== CUSTOM SCROLLBAR ===== */
    .form-control::-webkit-scrollbar {
        width: 8px;
    }

    .form-control::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }

    .form-control::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, var(--predict-primary), var(--predict-secondary));
        border-radius: 10px;
    }
</style>
{% endblock %}

{% block content %}
<div class="predict-wrapper">
    <div class="predict-card">
        
        <!-- ===== PREMIUM HEADER ===== -->
        <div class="predict-header">
            <h1>
                <i class="fas fa-robot"></i>
                Churn Prediction
            </h1>
            <p>Enter customer details to analyze churn risk with our ML model</p>
        </div>

        <!-- ===== PREDICTION FORM - YOUR EXACT LOGIC PRESERVED ===== -->
        <form method="post" action="{{ url_for('predict_datapoint') }}" onsubmit="showLoader()">

            <!-- ===== CUSTOMER PROFILE SECTION ===== -->
            <div class="section">
                <i class="fas fa-user-circle"></i>
                Customer Profile
            </div>
            <div class="form-grid">
                <div>
                    <label class="form-label">
                        <i class="fas fa-user"></i> Age
                    </label>
                    <input type="number" name="age" class="form-control" placeholder="e.g., 30" min="18" max="100" required>
                </div>

                <div>
                    <label class="form-label">
                        <i class="fas fa-venus-mars"></i> Gender
                    </label>
                    <select name="gender" class="form-select" required>
                        <option value="" disabled selected>Select gender</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                    </select>
                </div>

                <div>
                    <label class="form-label">
                        <i class="fas fa-calendar-check"></i> Weekly Active Days
                    </label>
                    <input type="number" name="weekly_active_days" class="form-control" placeholder="0-7" min="0" max="7" required>
                </div>

                <div>
                    <label class="form-label">
                        <i class="fas fa-clock"></i> Avg Session Time
                    </label>
                    <input type="number" step="0.1" name="avg_session_time" class="form-control" placeholder="minutes" min="0" max="1440" required>
                </div>

                <div>
                    <label class="form-label">
                        <i class="fas fa-coins"></i> Total Revenue
                    </label>
                    <input type="number" step="0.01" name="total_revenue" class="form-control" placeholder="Amount (â‚¹)" min="0" required>
                </div>

                <div>
                    <label class="form-label">
                        <i class="fas fa-exclamation-circle"></i> Payment Failures
                    </label>
                    <input type="number" name="payment_failures" class="form-control" placeholder="Count" min="0" required>
                </div>

                <div>
                    <label class="form-label">
                        <i class="fas fa-file-contract"></i> Contract Type
                    </label>
                    <select name="contract_type" class="form-select" required>
                        <option value="" disabled selected>Select contract</option>
                        <option value="Monthly">Monthly</option>
                        <option value="Yearly">Yearly</option>
                    </select>
                </div>

                <div>
                    <label class="form-label">
                        <i class="fas fa-credit-card"></i> Payment Method
                    </label>
                    <select name="payment_method" class="form-select" required>
                        <option value="" disabled selected>Select method</option>
                        <option value="Card">Credit Card</option>
                        <option value="PayPal">PayPal</option>
                        <option value="Bank Transfer">Bank Transfer</option>
                    </select>
                </div>

                <div>
                    <label class="form-label">
                        <i class="fas fa-headset"></i> Complaint Type
                    </label>
                    <select name="complaint_type" class="form-select">
                        <option value="No Complaint">No Complaint</option>
                        <option value="Billing">Billing Issue</option>
                        <option value="Service">Service Issue</option>
                        <option value="Technical">Technical Issue</option>
                    </select>
                </div>
            </div>

            <!-- ===== USAGE BEHAVIOR SECTION ===== -->
            <div class="section mt-5">
                <i class="fas fa-chart-bar"></i>
                Usage Behavior
            </div>
            <div class="form-grid">
                <div>
                    <label class="form-label">
                        <i class="fas fa-hourglass-half"></i> Tenure (months)
                    </label>
                    <input type="number" name="tenure_months" class="form-control" placeholder="Months" min="0" max="120" required>
                </div>
                <div>
                    <label class="form-label">
                        <i class="fas fa-sign-in-alt"></i> Monthly Logins
                    </label>
                    <input type="number" name="monthly_logins" class="form-control" placeholder="Count" min="0" required>
                </div>
            </div>

            <!-- ===== BILLING & SUPPORT SECTION ===== -->
            <div class="section mt-5">
                <i class="fas fa-credit-card"></i>
                Billing & Support
            </div>
            <div class="form-grid">
                <div>
                    <label class="form-label">
                        <i class="fas fa-dollar-sign"></i> Monthly Fee (â‚¹)
                    </label>
                    <input type="number" step="0.01" name="monthly_fee" class="form-control" placeholder="Amount" min="0" required>
                </div>
                <div>
                    <label class="form-label">
                        <i class="fas fa-ticket-alt"></i> Support Tickets
                    </label>
                    <input type="number" name="support_tickets" class="form-control" placeholder="Count" min="0" required>
                </div>
            </div>

            <!-- ===== CUSTOMER FEEDBACK SECTION ===== -->
            <div class="section mt-5">
                <i class="fas fa-star"></i>
                Customer Feedback
            </div>
            <div class="form-grid">
                <div>
                    <label class="form-label">
                        <i class="fas fa-smile"></i> CSAT Score (1-5)
                    </label>
                    <input type="number" min="1" max="5" name="csat_score" class="form-control" placeholder="1-5" required>
                </div>
                <div>
                    <label class="form-label">
                        <i class="fas fa-chart-line"></i> NPS Score
                    </label>
                    <input type="number" name="nps_score" class="form-control" placeholder="-100 to 100" min="-100" max="100" required>
                </div>
            </div>

            <!-- ===== SUBMIT BUTTON ===== -->
            <div class="text-center">
                <button type="submit" class="btn-predict-submit px-5">
                    <i class="fas fa-flask"></i>
                    Predict Churn Probability
                    <i class="fas fa-arrow-right"></i>
                </button>
            </div>

            <!-- ===== PREMIUM LOADER ===== -->
            <div id="loader" class="loader">
                <div class="spinner"></div>
                <p>Analyzing customer data with ML model...</p>
            </div>

            <!-- ===== FORM FOOTER ===== -->
            <div class="form-footer">
                <span>
                    <i class="fas fa-shield-alt"></i> Enterprise-grade security
                </span>
                <span>
                    <i class="fas fa-bolt"></i> Real-time predictions
                </span>
                <span>
                    <i class="fas fa-chart-line"></i> 92% accuracy
                </span>
            </div>

        </form>

        <!-- ===== RESULT SECTION - YOUR EXACT LOGIC PRESERVED ===== -->
        {% if results %}
            {% if results == "Churn" %}
                <div class="alert alert-danger text-center">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>
                        <strong>High Churn Risk</strong><br>
                        Customer is likely to churn - immediate action recommended
                    </div>
                </div>
            {% else %}
                <div class="alert alert-success text-center">
                    <i class="fas fa-check-circle"></i>
                    <div>
                        <strong>Low Churn Risk</strong><br>
                        Customer is likely to stay - continue engagement
                    </div>
                </div>
            {% endif %}
        {% endif %}

    </div>
</div>

<script>
    // ===== YOUR EXACT LOADER FUNCTION - PRESERVED =====
    function showLoader() {
        document.getElementById("loader").style.display = "block";
        // Auto-hide after 8 seconds (in case of long processing)
        setTimeout(function() {
            var loader = document.getElementById("loader");
            if (loader.style.display === "block") {
                loader.style.display = "none";
            }
        }, 8000);
    }

    // ===== PREMIUM FORM INTERACTIONS =====
    document.addEventListener('DOMContentLoaded', function() {
        // Add floating labels effect
        var inputs = document.querySelectorAll('.form-control, .form-select');
        inputs.forEach(function(input) {
            input.addEventListener('focus', function() {
                this.parentElement.classList.add('focused');
            });
            input.addEventListener('blur', function() {
                if (!this.value) {
                    this.parentElement.classList.remove('focused');
                }
            });
        });

        // Log form initialization
        console.log('ðŸš€ Premium Prediction Form Ready');
        console.log('ðŸ“Š Fields: 15 input fields ready for customer data');
    });
</script>
{% endblock %}

{% block extra_js %}
<!-- No extra JS - all JavaScript is in the main script block -->
{% endblock %}